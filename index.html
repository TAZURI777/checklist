<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸</title>
    <!-- ì›¹ì•± ì„¤ì • (ì•„ì´í°/ì•ˆë“œë¡œì´ë“œ í™ˆ í™”ë©´ ì¶”ê°€ ì‹œ ì•±ì²˜ëŸ¼ ë³´ì´ê²Œ í•¨) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ff6b6b">
    <!-- ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ (SheetJS) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #ff6b6b; /* ì ìƒ‰ íŒŒìŠ¤í…” í†¤ (Soft Red) */
            --bg-color: #fff5f5; /* ì•„ì£¼ ì—°í•œ ë¶‰ì€ë¹› ë°°ê²½ */
            --card-bg: #ffffff;
        }
        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0; /* ì „ì²´ í™”ë©´ ì‚¬ìš©ì„ ìœ„í•´ íŒ¨ë”© ì œê±° */
            color: #333;
            height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            height: 100%; /* ì»¨í…Œì´ë„ˆ ë†’ì´ í™•ë³´ */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        h2, h3 { margin-top: 0; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ë‚´ë¶€ ìŠ¤í¬ë¡¤ì„ ìœ„í•´ ë„˜ì¹˜ëŠ” ë‚´ìš© ìˆ¨ê¹€ */
        }
        
        /* í™”ë©´ ê½‰ ì°¨ê²Œ í•˜ê¸° ìœ„í•œ ìŠ¤íƒ€ì¼ */
        .card.full-screen {
            flex: 1;
            margin-bottom: 0;
        }

        /* ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
            color: #555;
        }
        input[type="text"], input[type="date"], input[type="number"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
        }

        /* ì¬ì„œë¹„ìŠ¤ìœ¨ ê°€ì§œ ì…ë ¥ì°½ (ì¢Œìš° ë°°ì¹˜) */
        .fake-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            background-color: #fff;
            display: flex;
            justify-content: space-between; /* ì¢Œìš° ëìœ¼ë¡œ ë°°ì¹˜ */
            align-items: center;
            cursor: pointer;
            color: #333;
        }
        .fake-input span {
            font-weight: bold;
        }
        .fake-input .placeholder { color: #888; font-weight: normal; }

        /* ì„ íƒ ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ (ì•„ì´ì½˜/ë²„íŠ¼ í˜•íƒœ) */
        .grid-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1; /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
            overflow-y: auto; /* ë‚´ìš©ì´ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
        }
        
        /* ì¦ìƒ ì„ íƒ ê·¸ë¦¬ë“œ (ë¦¬ìŠ¤íŠ¸ í˜•íƒœ ë³€í˜•) */
        #symptomGrid .option-card {
            flex-direction: row; /* ê°€ë¡œ ë°°ì¹˜ */
            justify-content: flex-start; /* ì¢Œì¸¡ ì •ë ¬ */
            text-align: left;
            padding: 20px;
            height: auto; /* ë†’ì´ ìë™ */
            flex: 0 0 auto; /* í¬ê¸° ê³ ì • ì•ˆí•¨ */
        }
        #symptomGrid .option-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 0;
            margin-right: 20px;
        }
        #symptomGrid .option-card span {
            font-size: 1.1rem;
        }

        .option-card {
            background: #fff;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            color: #555;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
            flex: 1; /* ë‚¨ì€ ê³µê°„ ê· ë“± ë¶„í•  */
        }
        .option-card.selected {
            border-color: var(--primary-color);
            background-color: #ffe3e3; /* ì„ íƒ ì‹œ ì—°í•œ íŒŒìŠ¤í…” ë ˆë“œ ë°°ê²½ */
            color: var(--primary-color);
        }

        /* ì œí’ˆ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .option-card img {
            width: 120px; height: 120px; margin-bottom: 15px; object-fit: contain;
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 12px; /* ë°•ìŠ¤ í˜•íƒœ */
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
            transition: transform 0.2s, border-color 0.2s;
        }
        .checklist-item:active { transform: scale(0.99); }
        .checklist-item.checked { border-color: var(--primary-color); background-color: #fff0f0; }

        .checklist-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 20px;
            accent-color: var(--primary-color);
        }
        .checklist-item label {
            font-size: 1rem;
            line-height: 1.6; /* ì¤„ ê°„ê²©ì„ ë„“í˜€ ê°€ë…ì„± í™•ë³´ */
            flex: 1; /* ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ì—¬ í´ë¦­ ì˜ì—­ í™•ëŒ€ */
            cursor: pointer; /* í´ë¦­ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì†ê°€ë½ ì»¤ì„œ í‘œì‹œ */
            display: flex; /* ë‚´ë¶€ ìš”ì†Œ ì •ë ¬ì„ ìœ„í•´ flex ì‚¬ìš© */
            align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
        }

        /* ì ê²€ ë‹¨ê³„ ë²ˆí˜¸ ë±ƒì§€ ìŠ¤íƒ€ì¼ */
        .step-badge {
            background: #ffeaea; /* ë±ƒì§€ ë°°ê²½ë„ ì—°í•œ ë¶‰ì€ í†¤ìœ¼ë¡œ */
            color: var(--primary-color);
            min-width: 45px;
            height: 45px;
            border-radius: 10px; /* ë‘¥ê·¼ ì‚¬ê°í˜• */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem; /* ìˆ«ì í¬ê²Œ */
            font-weight: 900;
            margin-right: 20px;
            flex-shrink: 0;
            border: 2px solid #dee2e6;
        }
        
        /* ì²´í¬ë¦¬ìŠ¤íŠ¸ ì˜ì—­ ìŠ¤í¬ë¡¤ */
        #checklistItems {
            flex: 1;
            overflow-y: auto;
        }
        
        /* ì§„í–‰ë¥  ë°” ìŠ¤íƒ€ì¼ */
        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 8px;
            height: 10px;
            margin-bottom: 5px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn:active { background-color: #fa5252; }
        .btn-success { background-color: #69db7c; } /* íŒŒìŠ¤í…” ê·¸ë¦° */
        
        /* ìˆ¨ê¹€ í´ë˜ìŠ¤ */
        .hidden { display: none !important; }

        /* 1. ìŠ¤í”Œë˜ì‹œ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            text-align: center;
            cursor: pointer;
        }
        #splashScreen h1 {
            font-size: 2.5rem;
            line-height: 1.4;
            margin-bottom: 40px;
        }
        #splashScreen .click-hint {
            position: absolute;
            bottom: 50px;
            font-size: 0.9rem;
            opacity: 0.8;
            animation: blink 2s infinite;
        }
        @keyframes blink {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }

        /* 3. ë©”ì¸ í™”ë©´ ìƒë‹¨ ì •ë³´ ìš”ì•½ ë°” */
        .info-summary-bar {
            background: #333;
            color: #fff;
            padding: 10px 15px;
            font-size: 0.8rem;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.4;
            cursor: pointer; /* í´ë¦­ ê°€ëŠ¥ í‘œì‹œ */
        }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .nav-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            flex-shrink: 0; /* ë²„íŠ¼ ì˜ì—­ì€ ì¤„ì–´ë“¤ì§€ ì•ŠìŒ */
        }
        .btn-nav {
            padding: 12px 10px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-nav.prev { background-color: #adb5bd; } /* íŒŒìŠ¤í…” íšŒìƒ‰ */
        .btn-nav.next { background-color: var(--primary-color); } /* íŒŒë€ìƒ‰ */

        /* íŒì—…(ëª¨ë‹¬) ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 10000;
            display: flex; justify-content: center; align-items: center;
        }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 85%; max-width: 320px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .modal-btns { display: flex; gap: 10px; margin-top: 10px; }

        /* ì´ë ¥ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .history-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }
        .history-item:last-child { border-bottom: none; }

        /* ì¢…í•© ì˜ê²¬ í…ìŠ¤íŠ¸ ì˜ì—­ */
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            resize: none;
            box-sizing: border-box;
            font-family: inherit;
        }
    </style>
</head>
<body>

<!-- 1. ìŠ¤í”Œë˜ì‹œ í™”ë©´ (ìµœì´ˆ ì‹¤í–‰ ì‹œ ë³´ì„) -->
<div id="splashScreen" onclick="goToUserInfo()" ontouchstart="goToUserInfo()">
    <h1>One Point<br>ì‹¤ë¬´ì¸¡ì •<br>ì²´í¬ ë¦¬ìŠ¤íŠ¸</h1>
    <p class="click-hint">í™”ë©´ì˜ ì•„ë¬´ê³³ì´ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
</div>

<!-- 2. ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í™”ë©´ -->
<div id="userInfoScreen" class="container hidden">
    <div class="card" style="margin-top: 20px;">
        <h3>ğŸ“‹ ë‹´ë‹¹ì ì •ë³´ ì…ë ¥</h3>
        <div id="userInfoForm">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™ ìƒì„±ë¨ -->
        </div>
        <button class="btn" onclick="goToMainApp()">ì €ì¥ í›„ ì ê²€ ì‹œì‘</button>
    </div>
</div>

<!-- 3. ë©”ì¸ ì ê²€ í™”ë©´ -->
<div id="mainAppScreen" class="container hidden">
    <!-- ìƒë‹¨ ì •ë³´ ìš”ì•½ -->
    <div id="userInfoSummary" class="info-summary-bar" onclick="confirmEditUserInfo()"></div>

    <!-- ì œí’ˆ ë° ì¦ìƒ ì„ íƒ -->
    <div class="card full-screen" id="productSelectionCard">
        <h3>ğŸ” ì œí’ˆ ì„ íƒ</h3>
        <div id="productGrid" class="grid-options">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë²„íŠ¼ ìƒì„±ë¨ -->
        </div>
    </div>

    <div class="card full-screen hidden" id="symptomSelectionCard">
        <h3>ğŸ” ì¦ìƒ ì„ íƒ</h3>
        <div id="symptomGrid" class="grid-options">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë²„íŠ¼ ìƒì„±ë¨ -->
        </div>
        <div class="nav-buttons">
            <button class="btn-nav prev" onclick="goBackToProduct()">â¬…ï¸ ì´ì „</button>
            <button class="btn-nav next" onclick="goToChecklist()">ë‹¤ìŒ â¡ï¸</button>
        </div>
    </div>

    <!-- 3. ì²´í¬ë¦¬ìŠ¤íŠ¸ (5ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤) -->
    <div id="checklistSection" class="card full-screen hidden">
        <h3 id="checklistTitle">âœ… ì ê²€ í”„ë¡œì„¸ìŠ¤</h3>
        <div style="margin-bottom: 15px;">
            <div class="progress-container"><div class="progress-bar" id="checklistProgressBar" style="width: 0%"></div></div>
            <p id="progressText" style="text-align: right; font-size: 0.9rem; color: #666; margin: 5px 0 0 0;">0% ì™„ë£Œ</p>
        </div>
        <div id="checklistItems">
            <!-- ì²´í¬ë°•ìŠ¤ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
        </div>
        <div class="nav-buttons">
            <button class="btn-nav prev" onclick="goBackToSymptom()">â¬…ï¸ ì´ì „</button>
            <button class="btn-nav next" onclick="goToOpinion()">ë‹¤ìŒ â¡ï¸</button>
        </div>
    </div>

    <!-- 4. ì¢…í•© ì˜ê²¬ ì‘ì„± -->
    <div id="opinionSection" class="card full-screen hidden">
        <h3>ğŸ“ ì¢…í•© ì˜ê²¬ ì‘ì„±</h3>
        <div style="flex: 1; display: flex; flex-direction: column;">
            <textarea id="opinionInput" placeholder="ì—¬ê¸°ì— ì¢…í•©ì˜ê²¬ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
        </div>
        <div class="nav-buttons">
            <button class="btn-nav prev" onclick="goBackToChecklist()">â¬…ï¸ ì´ì „</button>
            <button class="btn-nav next" onclick="processSave()">ì €ì¥</button>
        </div>
    </div>

    <!-- 5. ì €ì¥ ì´ë ¥ í™•ì¸ ë° ì™„ë£Œ í™”ë©´ -->
    <div id="historyScreen" class="card full-screen hidden">
        <h3>ğŸ’¾ ì €ì¥ëœ ì ê²€ ì´ë ¥</h3>
        <div class="history-list" id="historyListContainer">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì´ë ¥ ëª©ë¡ ìƒì„±ë¨ -->
        </div>
        <div style="text-align: center; font-size: 0.8rem; color: #666; margin-bottom: 10px;">
            ì´ <span id="historyCount">0</span>ê±´ì˜ ì ê²€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
        <div class="nav-buttons">
            <button class="btn-nav prev" onclick="goToProductSelectFromHistory()">ì œí’ˆ ì„ íƒ ğŸ”„</button>
            <button class="btn-nav" style="background-color: #ff8787;" onclick="clearHistoryData()">ğŸ—‘ï¸ ì‚­ì œ</button>
            <button class="btn-nav next" onclick="exportHistoryToExcel()">ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ğŸ“¥</button>
        </div>
    </div>
</div>

<!-- ì¬ì„œë¹„ìŠ¤ìœ¨ ì…ë ¥ íŒì—… (ìˆ¨ê¹€ ìƒíƒœ) -->
<div id="reserviceModal" class="modal-overlay hidden">
    <div class="modal-content">
        <h3>ğŸ“Š ì¬ì„œë¹„ìŠ¤ìœ¨ ì…ë ¥</h3>
        <label>êµìœ¡ ì „ (%)</label>
        <input type="number" id="modal_reservice_before" placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 10)">
        <label>êµìœ¡ í›„ (%)</label>
        <input type="number" id="modal_reservice_after" placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 5)">
        <div class="modal-btns">
            <button class="btn" style="background:#ccc; color:#333" onclick="closeReserviceModal()">ì·¨ì†Œ</button>
            <button class="btn" onclick="saveReserviceRate()">í™•ì¸</button>
        </div>
    </div>
</div>


<script>
    // ==========================================
    // [ê´€ë¦¬ì ì„¤ì • êµ¬ì—­] ì´ ë¶€ë¶„ë§Œ ìˆ˜ì •í•˜ë©´ ë‚´ìš©ì„ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    // ==========================================
    
    // 1. ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´ í•„ë“œ (ìˆ˜ì •ë¨)
    const USER_FIELDS = [
        "ë‹´ë‹¹/ì‹¤", "ì„¼í„°", "ì‚¬ë²ˆ", "ì„±ëª…", "êµìœ¡ ì´ìˆ˜ì¼ì", "ì¬ì„œë¹„ìŠ¤ìœ¨", "ì½”ì¹­ì"
    ];

    // 2. ì œí’ˆ ë° ì¦ìƒ, ì ê²€ ë¦¬ìŠ¤íŠ¸ ë°ì´í„° êµ¬ì¡°
    const CHECKLIST_DATA = {
        "ëƒ‰ì¥ê³ ": {
            "1. ëƒ‰ë™/ëƒ‰ì¥ ì•ˆë¨": [
                "1. ì˜¨ë„ ì„¤ì • ìƒíƒœ í™•ì¸<br>2. ìŒì‹ë¬¼ ìƒíƒœ í™•ì¸<br>3. ëƒ‰ê¸° ìœ .ë¬´ í™•ì¸<br>4. COMP ë™ì‘ ì†Œë¦¬ í™•ì¸<br>5. ëƒ‰ë™ì‹¤, ëƒ‰ì¥ì‹¤ íŒ¬ëª¨í„° ë™ì‘ ì—¬ë¶€ í™•ì¸<br>6. MAIN PCB ë‚´ LED ê¹œë°•ì„ í™•ì¸<br>7. All-on Modeì—ëŸ¬ í™•ì¸",
                "1. ì œí’ˆ RESET<br>2. ì „ì‹œ ëª¨ë“œ íˆ¬ì… í›„ í•´ì œí›„ ë™ì‘ í™•ì¸<br>3. TEST ëª¨ë“œ 1íšŒ ì§„ì…í•˜ì—¬ ì¬í™•ì¸",
                "1. COMP ë™ì‘ í™•ì¸ (ì§„ë™/ì†Œë¦¬)<br>1) Comp ì…ë ¥ ì „ì•• í™•ì¸<br>2) Comp ì €í•­ê°’ í™•ì¸",
                "1. ì‘ì¶•ê¸° ë°œì—´ìœ ë¬´ í™•ì¸<br>2. ì—ë°” ì°©ìƒ íŒ¨í„´ í™•ì¸<br>â€» ìœ„ ì ê²€ í›„ ì´ìƒì‹œ:<br>1) Main PCB êµì²´ ë˜ëŠ” ì¤‘ìˆ˜ë¦¬ ì—¬ë¶€ íŒë‹¨<br>2) COMP ì§„ë‹¨ JIG ì‚¬ìš©ì§„ë‹¨<br>3) ì••ë ¥ ì²´í¬ (í‰ì••/ê³ ì••/ì €ì••)",
                "1. ì‘ì¶•ê¸° ë°œì—´ìœ ë¬´ í™•ì¸<br>2. ì—ë°” ì°©ìƒ íŒ¨í„´ í™•ì¸<br>â€» ìœ„ ì ê²€ í›„ ì •ìƒì‹œ:<br>1) íŒ¬ëª¨í„°, ëŒí¼ ë‹¨í’ˆ ì ê²€<br>2) ì˜¨ë„ê³„ ì˜¨ë„ ì¸¡ì • í›„ ì •ìƒì‹œ ì‚¬ìš©ì„¤ëª…ì²˜ë¦¬"
            ], // 5ê°œ
            "2. ëƒ‰ì¥ ì•½/ê³¼ëƒ‰": [
                "1. ì˜¨ë„ ì„¤ì • ìƒíƒœ í™•ì¸<br>2. ìŒì‹ë¬¼ ìƒíƒœ í™•ì¸<br>3. ëƒ‰ê¸° ìœ .ë¬´ í™•ì¸<br>4. COMP ë™ì‘ ì†Œë¦¬ í™•ì¸<br>5. ëƒ‰ë™ì‹¤, ëƒ‰ì¥ì‹¤ íŒ¬ëª¨í„° ë™ì‘ ì—¬ë¶€ í™•ì¸<br>6. MAIN PCB ë‚´ LED ê¹œë°•ì„ í™•ì¸<br>7. All-on Modeì—ëŸ¬í™•ì¸",
                "1. ëª¨ë¸ë³„ ì„¼ì„œ / ëƒ‰ê¸° í† ì¶œêµ¬ ìœ„ì¹˜ í™•ì¸<br>2. ì„¼ì„œ / ëƒ‰ê¸° í† ì¶œêµ¬ ìŒì‹ë¬¼ë¡œ ê°€ë ¤ì§ ì—¬ë¶€ í™•ì¸",
                "1. ì„¼ì„œ ë‹¨í’ˆ ì •ìƒ ì—¬ë¶€ í™•ì¸<br>(ë‹¨í’ˆ ì €í•­ê°’ ë˜ëŠ” ì…ë ¥ì „ì••í™•ì¸)",
                "1. Test ëª¨ë“œ 2 ì´ìš©í•œ ëŒí¼ ì •ìƒ ì‘ë™ì—¬ë¶€ í™•ì¸<br>2. ëŒí¼ ì‘ë™ ë¶ˆëŸ‰ì‹œ ì…ë ¥ì „ì•• í™•ì¸",
                "1. ì˜¨ë„ê³„ ë˜ëŠ” ì•„ë¥´ê³ ìŠ¤ í™œìš© ì˜¨ë„ ì¸¡ì • í›„ ì •ìƒ ì‹œ ì‚¬ìš©ì„¤ëª…ì²˜ë¦¬"
            ], // 5ê°œ
            "3. ì„±ì—/ê²°ë¡œ/ì´ìŠ¬ë§ºí˜": [
                "1. í™ˆë°”, ë„ì–´ ë° ê°€ìŠ¤ì¼“ ìƒíƒœ í™•ì¸<br>2. ëƒ‰ë™ì‹¤ í”„ë¡ íŠ¸C ìƒíƒœ í™•ì¸<br>3. ì œë¹™ë„ì–´ ë² íƒ€ ê°€ìŠ¤ì¼“ í™•ì¸<br>4. ì •ìˆ˜ê¸° ëƒ‰ì¥ê³  ìº¡ ë•íŠ¸ ìƒíƒœ í™•ì¸",
                "1. ë ˆê·¸ íŒŒì† ì—¬ë¶€ í™•ì¸ (ë„ì–´ ëœë‹«í˜)<br>2. ìˆ˜í‰ ìƒíƒœ í™•ì¸ (ë„ì–´ë‹¨ì°¨, ìˆ˜í‰)<br>3. í•„í„° ë° ìˆ˜ë°°ê´€ ì—°ê²°ë¶€ í™•ì¸",
                "1. ì¤‘ìˆ˜ë¦¬ ì´ë ¥ í™•ì¸ (ì§„ê³µ ì‘ì—… ë¯¸í¡)<br>2. EVAì°©ìƒ ìƒíƒœ í™•ì¸ (ìƒë¶€ ê²°ë¹™)"
            ], // 3ê°œ
            "4. ë°°ìˆ˜êµ¬ ë§‰í˜, ëˆ„ìˆ˜": [
                "1. ì—ë°” ë° ë°°ìˆ˜êµ¬ ìƒíƒœ í™•ì¸ (ê²°ë¹™ ì—¬ë¶€ í™•ì¸)<br>2. ìŠ¤íŒ€ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ë°˜ ê²°ë¹™ ì œê±° ìˆ˜ë¦¬ ì¶”ê°€ì ìœ¼ë¡œ ë“œë ˆì¸ í˜¸ìŠ¤ ë° ê¸°ê³„ì‹¤ ìƒíƒœ í™•ì¸ í›„ ì¶”ê°€ ì„¸ì²™<br>3. ë“œë ˆì¸ í˜¸ìŠ¤ í™•ì¸ ë° ë“œë ˆì¸ í˜¸ìŠ¤ ë§ˆê°œ ë³€í˜• í™•ì¸",
                "1. MAIN PCB ë‚´ ë°°ìˆ˜êµ¬ íˆí„° PIN í™•ì¸í•˜ì—¬ ë°°ìˆ˜êµ¬ íˆí„° ì €í•­ê³¼ ì „ì••ì„ ì¸¡ì •-ë‹¨ì„  ìœ .ë¬´ë¥¼ ì²´í¬<br>2. í•„í„° ë° ìˆ˜ë°°ê´€ ì—°ê²°ë¶€ í™•ì¸",
                "1. ê¸°ê³„ì‹¤ Tube Assmbly, Drainì— Hole ì¶”ê°€ í›„ ë°°ìˆ˜êµ¬ ê²°ë¹™ SVCìš© Heater ì‚½ì…",
                "1. Joint Harness ê²°ì„  ë° ì •ë¦¬",
                "1. PCB Rewriting ë˜ëŠ” Main PCB êµì²´"
            ], // 5ê°œ
            "5. ì†ŒìŒ ë¶ˆëŸ‰": [
                "1. Doorë¥¼ ì¼ì •ì‹œê°„ ì—´ì—ˆë‹¤ Doorë¥¼ ë‹«ì€ í›„ íŒ¬ëª¨í„° ë™ì‘ ì—¬ë¶€ í™•ì¸ (íŒ¬ëª¨í„° ë™ì‘ ì—¬ë¶€ í™•ì¸ í›„ íŒ¬ëª¨í„° ë™ì‘ ì†ŒìŒì„ í™•ì¸)<br>2. í™•ì¸ì´ ì–´ë ¤ìš¸ ê²½ìš° Test 1ë²ˆ ëˆŒëŸ¬ íŒ¬ëª¨í„° ë™ì‘<br>3. COMP ë™ì‘ ìƒíƒœ í™•ì¸ (TEST 1 ëˆŒëŸ¬ í™•ì¸) ë° ë°°ê´€ ë–¨ë¦¼ìŒ ì—¬ë¶€ í™•ì¸<br>4. 3Way ë°¸ë¸Œ ë™ì‘ í™•ì¸ (ì „ì›ë¦¬ì…‹ ë˜ëŠ” 3Way ë°¸ë¸Œ JIG ì—°ê²° ë™ì‘ í™•ì¸)",
                "1. ë°”ëŒì´ ì˜ ë‚˜ì˜¤ëŠ”ì§€, ë°°ê´€ ë–¨ë¦¼ìŒë° COMP ì´ìƒ ì†ŒìŒì€ ì—†ëŠ”ì§€ ì´‰ê°ê³¼ ì²­ê°ì„ ì´ìš©í•˜ì—¬ í™•ì¸<br>2. ì•„ì´ìŠ¤ë©”ì´ì»¤ ë° í¬ë˜í”„íŠ¸ì•„ì´ìŠ¤ë©”ì´ì»¤ ì´ë¹™ë™ì‘ ì‹œ (Test SWëˆŒëŸ¬ í™•ì¸)ì†ŒìŒ ì—¬ë¶€ í™•ì¸.<br>3. ëŒí¼ ì ìš© ëª¨ë¸ ëŒí¼ ë™ì‘ ìƒíƒœ í™•ì¸ (Test ë²„íŠ¼ì„ ì´ìš©í•˜ì—¬ í™•ì¸)",
                "1. ì´ìƒ ì†ŒìŒì´ í™•ì¸ë˜ëŠ” ê²½ìš° ë•íŠ¸ë¥¼ ë¶„í•´í•˜ì—¬ ë² ì–´ë§/ì„±ì—/ê²°ë¹™/íŒ¬ê±¸ë¦¼ ë“±ì„ ìœ¡ì•ˆìœ¼ë¡œ í™•ì¸",
                "1. ì„±ì—/ê²°ë¹™/íŒ¬ê±¸ë¦¼ì´ ì•„ë‹ˆë¼ë©´ ì†ìœ¼ë¡œ ì§ì ‘ íŒ¬ì„ ëŒë ¤ ë³¸ë‹¤(ë¶€ë“œëŸ½ê²Œ ëŒì•„ê°€ëŠ”ì§€ í™•ì¸)<br>- ë² ì–´ë§ì†ŒìŒ<br>- ì„±ì—/ê²°ë¹™<br>- íŒ¬ ê±¸ë¦¼",
                "1. COMPí˜•ëª… í™•ì¸ í•˜ì—¬ ( FMA088NBMA, FMA102NAMA, FMA102NBMA, FLD165NBMA) ì¸ê²½ìš° PGM ì—…ë°ì´íŠ¸ í™•ì¸<br>2. ê¹€ì¹˜ëƒ‰ì¥ê³  24ë…„ 11ì›” ì´ì „ ì œë²ˆ PGM ì—…ë°ì´íŠ¸ ì—¬ë¶€ í™•ì¸<br>3. 4ë„ì–´ ëƒ‰ì¥ê³ (2025.07ì›” ~ 11ì›”24ì¼) ëƒ‰ë§¤ìŒ ê°œì„  PGM ì—…ë°ì´íŠ¸ í™•ì¸<br>4. í•„ìš”ì— ë”°ë¼ ì°¨ìŒíŒ, ì œì§„ì¬, ì‹œíŠ¸ëŸ¬ë²„, ê³µëª…ê¸°, EPDMë“± í™œìš© ì¡°ì • ë˜ëŠ” êµì²´"
            ], // 5ê°œ
            "6. ìƒëƒ‰ì¥í•˜ëƒ‰ë™ ë„ì–´ ì—¬ë‹«í˜ë¶ˆ ": [
                "1. í•„ëŸ¬ íˆí„° ê°„ì„­ìœ¼ë¡œ ì¸í•œ ë„ì–´ ì•ˆì—´ë¦¼ í™•ì¸<br>2. ìŒì‹ë¬¼ ê°„ì„­ ì—¬ë¶€ ë° ê°€ìŠ¤ì¼“ íƒˆê±° ì—¬ë¶€ í™•ì¸<br>3. ì„ ë°˜ ë° ë³‘ê½‚ì´ ì¡°ë¦½ ìƒíƒœ í™•ì¸",
                "1. ë„ì–´ ë‹¨ì°¨/ ìˆ˜í‰ìƒíƒœ í™•ì¸",
                "1. ë„ì–´ ìƒë¶€ íŒì§€, ì˜¤í†  íŒì§€ ìƒíƒœ í™•ì¸",
                "1. ëŒ€ì¹˜ Door êµì²´ ì‹œ ë„ì–´ ì•ˆë‹«í˜ í™•ì¸ (ë² íƒ€ ê°€ìŠ¤ì¼“ Size ìƒì´)",
                "1. ë¡¤ëŸ¬ íŒŒì† ìƒíƒœ í™•ì¸"
            ], // 5ê°œ
            "7. ë””ìŠ¤íœì„œ/ì•„ì´ìŠ¤ë©”ì´ì»¤ ì´ìƒ": [
                "1. All-on ëª¨ë“œ ì§„ì…í•˜ì—¬ ì—ëŸ¬ í™•ì¸<br>2. ì•„ì´ìŠ¤ë©”ì´ì»¤ ON ìƒíƒœ í™•ì¸",
                "1. ì–¼ìŒ ìƒì„± ì—¬ë¶€ í™•ì¸<br>2. ë””ìŠ¤íœì„œ ì¶œìˆ˜ ì—¬ë¶€í™•ì¸",
                "1. ì•„ì´ìŠ¤ë©”ì´ì»¤ í…ŒìŠ¤íŠ¸ëª¨ë“œ SW ë™ì‘í™•ì¸",
                "1. ì•„ì´ìŠ¤ë©”ì´ì»¤ ê¸‰ìˆ˜ê´€ ê²°ë¹™ í™•ì¸",
                "1. ë„ì–´ í•˜ë„¤ìŠ¤ ë‹¨ì„  ì—¬ë¶€ í™•ì¸<br>2. Sub PCB í™•ì¸"
            ], // 5ê°œ
            "8. ì „ì›/ëˆ„ì „": [
                "1. ëˆ„ì „ ì°¨ë‹¨ê¸° ìƒíƒœ í™•ì¸",
                "1. ì „ì› ë¦¬ì…‹ í›„ ì¬í™•ì¸",
                "1. í•„ëŸ¬ íˆí„° ëˆ„ì „ í™•ì¸",
                "1. ì‰¬ì¦ˆ íˆí„° ëˆ„ì „í™•ì¸",
                "1. ë©”ê°€ í…ŒìŠ¤í„°ê¸° ì‚¬ìš© ëˆ„ì „ í™•ì¸"
            ] // 5ê°œ
        },
        "ì„¸íƒê¸°": {
            "1. IE ì—ëŸ¬ ë¶ˆëŸ‰": [
                "1. ìˆ˜ë„ ê¼­ì§€ ì ê¸ˆ ì—¬ë¶€ í™•ì¸<br>2. ë™ê²° í™•ì¸<br>3. ê¸‰ìˆ˜ ë°¸ë¸Œ í•„í„° ì´ë¬¼ ë§‰í˜ í™•ì¸<br>4. ìˆ˜ì•• í™•ì¸<br>5. í…ŒìŠ¤íŠ¸ëª¨ë“œë¡œ ê¸‰ìˆ˜ë™ì‘ í™•ì¸",
                "1. ì••ë ¥ì„¼ì„œ ë‹¨í’ˆ ì ê²€<br>2. ì‚¬ì´í€ í™€ ë§‰í˜ ì—¬ë¶€ í™•ì¸",
                "1. ê¸‰ìˆ˜ë°¸ë¸Œ ë‹¨ì„ /ë§‰í˜ í™•ì¸<br>2. ê¸‰ìˆ˜ë°¸ë“œ ì—°ê²° í•˜ë„¤ìŠ¤ ìƒíƒœ í™•ì¸",
                "1. Main Pcb ì¶œë ¥ ì „ì•• í™•ì¸ (ê¸‰ìˆ˜ë°¸ë¸Œ ì…ë ¥ì „ì••)"
            ], // 4ê°œ
            "2. OE ì—ëŸ¬ ë¶ˆëŸ‰": [
                "1. ë°°ìˆ˜í˜¸ìŠ¤ ìƒíƒœ í™•ì¸ (ì„¤ì¹˜ìƒíƒœ, ì´ë¬¼ë§‰í˜, ë™ê²°)",
                "1. PV Case ì´ë¬¼ ë§‰í˜ ìƒíƒœ í™•ì¸",
                "1. ë°°ìˆ˜íŒí”„ ë‹¨í’ˆ Check",
                "1. ì••ë ¥ì„¼ì„œ, ì••ë ¥í˜¸ìŠ¤ Check",
                "1. Main Pcb ì¶œë ¥ ì „ì•• í™•ì¸ (ë°°ìˆ˜íŒí”„ ì…ë ¥ì „ì••)"
            ], // 5ê°œ
            "3. LE ì—ëŸ¬ ë¶ˆëŸ‰(í™€ì„¼ì„œ ëª¨ë¸)": [
                "1. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ëª¨í„° íšŒì „ ì—¬ë¶€ í™•ì¸",
                "1. í™€ì„¼ì„œ ë‹¨í’ˆ Check<br>2. ìŠ¤í…Œì´í„° ë‹¨í’ˆ Check<br>3. ë¡œí„° ìì„ ìƒíƒœ í™•ì¸",
                "1. Main Pcb ì¶œë ¥ ì „ì•• í™•ì¸ (í™€ì„¼ì„œ ì…ë ¥ì „ì••)"
            ], // 3ê°œ
            "4. LE ì—ëŸ¬ ë¶ˆëŸ‰(ì„¼ì„œë¦¬ìŠ¤ ëª¨ë¸)": [
                "1. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ëª¨í„° íšŒì „ ì—¬ë¶€ í™•ì¸",
                "1. ìŠ¤í…Œì´í„° ë‹¨í’ˆ Check<br>2. ë¡œí„° ìì„ ìƒíƒœ í™•ì¸",
                "1. ë©”ì¸-ìŠ¤í…Œì´í„° í•˜ë„¤ìŠ¤ ë‹¨ì„  í™•ì¸<br>2. ì¸ë²„í„° PCB ì¶œë ¥ ì „ì•• í™•ì¸(ì¸ë²„í„° PCBì ìš©ëª¨ë¸)"
            ], // 3ê°œ
            "5. DE/DL ì—ëŸ¬ ë¶ˆëŸ‰": [
                "1. ë„ì–´ Lock ë™ì‘ìƒíƒœ í™•ì¸<br>2. ì œí’ˆ ìˆ˜í‰ìƒíƒœ í™•ì¸ (ë„ì–´ ì²˜ì§/ ê°€ìŠ¤ì¼“í™•ì¸)<br>2. ë¦¬ë“œ ìì„ ë¶€ì°© ìƒíƒœ í™•ì¸ (í†µëŒì´)",
                "1. ì œí’ˆ ìˆ˜í‰ìƒíƒœ í™•ì¸ (ë„ì–´ ì²˜ì§/ ê°€ìŠ¤ì¼“í™•ì¸)",
                "1. ë¦¬ë“œìŠ¤ìœ„ì¹˜, ë¦¬ë“œ Lock, ë„ì–´ SW ë‹¨í’ˆ Check.",
                "1. Main Pcb ì „ì•• í™•ì¸"
            ], // 4ê°œ
            "6. DHE/TE/FF ì—ëŸ¬ ë¶ˆëŸ‰": ["1. ê±´ì¡° íŒ¬ëª¨í„° ë™ì‘ ìƒíƒœ í™•ì¸", "1. ê±´ì¡°íœ ì—°ê²° í•˜ë„¤ìŠ¤ ë‹¨ì„  í™•ì¸", "1. Main Pcb ì „ì•• í™•ì¸"], // 3ê°œ
            "7. ì „ì› ë¬´ê°": ["1. ë²½ë©´ ì½˜ì„¼íŠ¸ ì „ì•• Check", "1. ë…¸ì´ì¦ˆ í•„í„° ì…/ì¶œë ¥ ì „ì•• í™•ì¸(fuse ë‹¨ì„ )", "1. Sub Pcb ì „ì•• í™•ì¸", "1. Main Pcb ì „ì•• í™•ì¸"], // 4ê°œ
            "8. ì†ŒìŒ/ì§„ë™": [
                "1. ì„¸íƒë¬¼ ìƒíƒœ í™•ì¸ (ê³¼ë‹¤íˆ¬ì…, ì‚¬ìš©ë¶ˆê°€ì„¸íƒë¬¼, ëŒ€í˜• ì„¸íƒë¬¼ íˆ¬ì…, ì„¸íƒë§ ì‚¬ìš©(ë‹¨ë…))<br>2. ìˆ˜í‰ìƒíƒœ í™•ì¸ (ìˆ˜í‰ê³„ í™•ì¸)",
                "1. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ íƒˆìˆ˜ ë™ì‘ í™•ì¸(ì„¤ì¹˜ëª¨ë“œ)",
                "1. ë‚´ë¶€ ì´ë¬¼ì§ˆ ìœ ì…ì—¬ë¶€ í™•ì¸<br>2. ë¯¸ëŒì–´ì§ ì¼ ê²½ìš° ìŠ¤í† í¼ (ì‹ í˜•ìœ¼ë¡œ ë³€ê²½ ê¸°ì¡´ ê²€ì •->ì‹ í˜• íšŒìƒ‰)"
            ], // 3ê°œ
            "9. ëˆ„ìˆ˜": [
                "1. ì›í„°ì¹˜ ì¡°ë¦½ë¶€ í™•ì¸(ì›í„°ì¹˜ ë‚´ë¶€ ê°€ìŠ¤ì¼“ ë³€í˜• í™•ì¸)<br>2. ë°°ìˆ˜í˜¸ìŠ¤, ê¸‰ìˆ˜í˜¸ìŠ¤ ìƒíƒœ í™•ì¸<br>3. ê²¨ìš¸ì²  ê²°ë¡œ í™•ì¸<br>4. ì£¼ë³€ í™˜ê²½ ëˆ„ìˆ˜ í™•ì¸(ë³´ì¼ëŸ¬ë“±)<br>5. ì„¸ì œ ê³¼ë‹¤ ì‚¬ìš© ë° ì˜¤ì‚¬ìš©(ì¼ë°˜ì„¸íƒê¸°ìš© ë“œëŸ¼ì‚¬ìš©)",
                "1. ê°€ìŠ¤ì¼“ ì°¢ì–´ì§ í™•ì¸<br>2. ë°°ìˆ˜í•„í„° ì¡°ë¦½ìƒíƒœ í™•ì¸<br>3. ë””ìŠ¤íœì„œë¶€ ëˆ„ìˆ˜ í™•ì¸",
                "1. ë°¸ë¡œìš°ì¦ˆ ì°¢ì–´ì§ í™•ì¸<br>2. ê¸‰ìˆ˜ë°¸ë“œ ë™íŒŒ í™•ì¸<br>3. ë‚´ë¶€ í˜¸ìŠ¤ë¥˜ íŒŒì† í™•ì¸<br>4. ì•„ì›ƒì¼€ì´ìŠ¤ íŒŒì† í™•ì¸"
            ] // 3ê°œ
        },
        "ê±´ì¡°ê¸°": {
            "1. ê±´ì¡°ì•½/ê±´ì¡°ì•ˆë¨": [
                "1. ë””ìŠ¤í”Œë ˆì´ ì—ëŸ¬ í‘œì‹œë¨ í™•ì¸<br>2. í•„í„° ë§‰í˜ í™•ì¸",
                "1. ì½˜ë´ì„œ ì´ë¬¼ ê³¼ë‹¤ ìƒíƒœ í™•ì¸<br>2. ì‹¸ì´í´ ëƒ‰ë§¤ëˆ„ì„¤ (15ë¶„ë™ì‘ ì†Œë¹„ì „ë ¥ Check)",
                "1. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì½¤í”„ ë™ì‘ìƒíƒœ í™•ì¸<br>2. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ H ê°’ í™•ì¸<br>3. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ L ê°’ í™•ì¸<br>4. Data Vview í™•ì¸<br>5. ë¸”ë™ë°•ìŠ¤, Argus ì ê²€",
                "1. Comp ë‹¨í’ˆ ì €í•­ê°’ í™•ì¸"
            ], // 4ê°œ
            "2. ì†ŒìŒ/ì§„ë™": [
                "1. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ë“œëŸ¼ íšŒì „ ë™ì‘ìƒíƒœ í™•ì¸<br>2. ì¼€ì´ìŠ¤ ë–¨ë¦¼ìŒ í™•ì¸",
                "1. ë¡¤ëŸ¬ ìƒíƒœ Check<br>2. ëŒí•‘ ì‹œíŠ¸ íƒˆê±° Check.<br>3. íŒ¬ëª¨í„° ìƒíƒœ Check.",
                "1. ê°ì†ê¸° ë™ì‘ ìƒíƒœ í™•ì¸",
                "1. ë°°ìˆ˜íŒí”„ ë™ì‘ ìƒíƒœ í™•ì¸"
            ] // 4ê°œ
        }
    };

    // ì¦ìƒë³„ ì•„ì´ì½˜ ë§¤í•‘ (SVG) - ì˜¤í”„ë¼ì¸ ì§€ì›
    function getSymptomIcon(symptomName) {
        const name = symptomName.toLowerCase();
        let svg = "";
        
        // í‚¤ì›Œë“œì— ë”°ë¥¸ ì•„ì´ì½˜ ì„ íƒ
        if (name.includes("ì „ì›") || name.includes("power")) {
            // ë²ˆê°œ ì•„ì´ì½˜
            svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ffcc80"><path d="M7 2v11h3v9l7-12h-4l4-8z"/></svg>`; /* íŒŒìŠ¤í…” ì˜ë¡œìš°/ì˜¤ë Œì§€ */
        } else if (name.includes("ì†ŒìŒ") || name.includes("ì§„ë™")) {
            // ì†Œë¦¬/íŒŒë™ ì•„ì´ì½˜
            svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#b0bec5"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>`; /* íŒŒìŠ¤í…” ê·¸ë ˆì´ */
        } else if (name.includes("ëˆ„ìˆ˜") || name.includes("ë¬¼") || name.includes("ë°°ìˆ˜") || name.includes("ê¸‰ìˆ˜")) {
            // ë¬¼ë°©ìš¸ ì•„ì´ì½˜
            svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#81d4fa"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>`; /* íŒŒìŠ¤í…” ë¸”ë£¨ */
        } else if (name.includes("ë„ì–´") || name.includes("ë¬¸")) {
            // ë¬¸ ì•„ì´ì½˜
            svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#bcaaa4"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0v16H5V5h7zm7 16h-5V5h5v14zm-3-8h-2v2h2v-2z"/></svg>`; /* íŒŒìŠ¤í…” ë¸Œë¼ìš´ */
        } else if (name.includes("ì—ëŸ¬") || name.includes("ë””ìŠ¤í”Œë ˆì´") || name.includes("í™”ë©´")) {
            // ê²½ê³ /í™”ë©´ ì•„ì´ì½˜
            svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ef9a9a"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>`; /* íŒŒìŠ¤í…” ë ˆë“œ */
        } else if (name.includes("ëƒ‰ë™") || name.includes("ëƒ‰ì¥") || name.includes("ì˜¨ë„")) {
            // ì˜¨ë„ê³„ ì•„ì´ì½˜
            svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#80deea"><path d="M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zm-4-8c0-.55.45-1 1-1s1 .45 1 1v1h-2V5z"/></svg>`; /* íŒŒìŠ¤í…” ì‹œì•ˆ */
        } else {
            // ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´ì½˜
            svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a5d6a7"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>`; /* íŒŒìŠ¤í…” ê·¸ë¦° */
        }

        // Base64ë¡œ ë³€í™˜í•˜ì—¬ img srcì— ë„£ì„ ìˆ˜ ìˆê²Œ ì²˜ë¦¬
        return "data:image/svg+xml;base64," + btoa(svg);
    }

    // ì œí’ˆë³„ ì•„ì´ì½˜ ì´ë¯¸ì§€ ì£¼ì†Œ ë§¤í•‘
    const PRODUCT_ICONS = {
        // [ì´ë¯¸ì§€ ì½”ë“œ ì‹¬ëŠ” ë°©ë²•]
        // ì¸í„°ë„·ì— 'ì´ë¯¸ì§€ base64 ë³€í™˜' ê²€ìƒ‰ -> ë³€í™˜ ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ì§„ ì—…ë¡œë“œ -> ê²°ê³¼ê°’(data:image...)ì„ ë³µì‚¬í•´ì„œ ì•„ë˜ ë”°ì˜´í‘œ ì•ˆì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
        "ëƒ‰ì¥ê³ ": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHJlY3QgeD0iMTYiIHk9IjQiIHdpZHRoPSIzMiIgaGVpZ2h0PSI1NiIgcng9IjIiIGZpbGw9IiNlM2YyZmQiIHN0cm9rZT0iIzIxOTZmMyIgc3Ryb2tlLXdpZHRoPSIyIi8+PGxpbmUgeDE9IjE2IiB5MT0iMjAiIHgyPSI0OCIgeTI9IjIwIiBzdHJva2U9IiMyMTk2ZjMiIHN0cm9rZS13aWR0aD0iMiIvPjxsaW5lIHgxPSIzMiIgeTE9IjIwIiB4Mj0iMzIiIHkyPSI2MCIgc3Ryb2tlPSIjMjE5NmYzIiBzdHJva2Utd2lkdGg9IjIiLz48L3N2Zz4=", 
        "ì„¸íƒê¸°": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHJlY3QgeD0iMTIiIHk9IjgiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0OCIgcng9IjIiIGZpbGw9IiNmNWY1ZjUiIHN0cm9rZT0iIzYxNjE2MSIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMTIiIGZpbGw9IiNiM2U1ZmMiIHN0cm9rZT0iIzYxNjE2MSIgc3Ryb2tlLXdpZHRoPSIyIi8+PGxpbmUgeDE9IjEyIiB5MT0iMTYiIHgyPSI1MiIgeTI9IjE2IiBzdHJva2U9IiM2MTYxNjEiIHN0cm9rZS13aWR0aD0iMiIvPjxjaXJjbGUgY3g9IjQ0IiBjeT0iMTIiIHI9IjIiIGZpbGw9IiNlZjUzNTAiLz48L3N2Zz4=", 
        "ê±´ì¡°ê¸°": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHJlY3QgeD0iMTIiIHk9IjgiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0OCIgcng9IjIiIGZpbGw9IiNmZmYzZTAiIHN0cm9rZT0iI2ZmOTgwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMTIiIGZpbGw9IiNmZmUwYjIiIHN0cm9rZT0iI2ZmOTgwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGxpbmUgeDE9IjEyIiB5MT0iMTYiIHgyPSI1MiIgeTI9IjE2IiBzdHJva2U9IiNmZjk4MDAiIHN0cm9rZS13aWR0aD0iMiIvPjwvc3ZnPg=="
    };

    // í˜„ì¬ ì„ íƒëœ ìƒíƒœ ì €ì¥ ë³€ìˆ˜
    let currentProduct = "";
    let currentSymptom = "";
    
    // ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ ì €ì¥ ë³€ìˆ˜ (í™”ë©´ ì´ë™ ì‹œ ìœ ì§€ìš©)
    const checklistState = {}; // Key: "ì œí’ˆ_ì¦ìƒ", Value: Set(ì²´í¬ëœ í•­ëª© ì¸ë±ìŠ¤)
    const opinionState = {};   // Key: "ì œí’ˆëª…", Value: String(ì¢…í•©ì˜ê²¬ ë‚´ìš©)
    let currentEntryId = null; // í˜„ì¬ ì ê²€ í•­ëª©ì˜ ê³ ìœ  ID (ì¤‘ë³µ ë°©ì§€ìš©)

    // ==========================================
    // [ì•± ë¡œì§] ì•„ë˜ëŠ” ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.
    // ==========================================

    // ì´ˆê¸°í™” ì‹¤í–‰
    window.onload = function() {
        renderUserFields();
        loadUserInfo();
        renderProductOptions();
    };

    // í™”ë©´ ì „í™˜: ìŠ¤í”Œë˜ì‹œ -> ì •ë³´ ì…ë ¥
    function goToUserInfo() {
        document.getElementById('splashScreen').classList.add('hidden');
        document.getElementById('userInfoScreen').classList.remove('hidden');
    }

    // í™”ë©´ ì „í™˜: ì •ë³´ ì…ë ¥ -> ë©”ì¸ ì•±
    function goToMainApp() {
        // ì •ë³´ ì €ì¥
        saveUserInfo();
        
        // ìš”ì•½ ì •ë³´ í‘œì‹œ
        updateSummaryBar();

        document.getElementById('userInfoScreen').classList.add('hidden');
        document.getElementById('mainAppScreen').classList.remove('hidden');
    }

    // ë‹´ë‹¹ì ì •ë³´ ìˆ˜ì • í™•ì¸ íŒì—…
    function confirmEditUserInfo() {
        if(confirm("ë‹´ë‹¹ì ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            document.getElementById('mainAppScreen').classList.add('hidden');
            document.getElementById('userInfoScreen').classList.remove('hidden');
        }
    }

    // ìƒë‹¨ ìš”ì•½ ë°” ì—…ë°ì´íŠ¸
    function updateSummaryBar() {
        const summaryDiv = document.getElementById('userInfoSummary');
        const values = [];
        USER_FIELDS.forEach((field, index) => {
            const val = document.getElementById('user_field_' + index).value;
            if(val) values.push(val);
        });
        // "í™ê¸¸ë™ | Aì„¼í„° | ..." í˜•íƒœë¡œ í‘œì‹œ
        summaryDiv.innerText = values.join(' | ');
    }

    // 1. ì‚¬ìš©ì ì •ë³´ í•„ë“œ ìƒì„± ë° ë¡œë“œ
    function renderUserFields() {
        const container = document.getElementById('userInfoForm');
        container.innerHTML = ''; // ì´ˆê¸°í™”
        USER_FIELDS.forEach((field, index) => {
            const label = document.createElement('label');
            label.innerText = field;
            container.appendChild(label);
            
            if (field === 'êµìœ¡ ì´ìˆ˜ì¼ì') {
                // ë‹¬ë ¥ ì…ë ¥ì°½
                const input = document.createElement('input');
                input.type = 'date';
                input.id = 'user_field_' + index;
                container.appendChild(input);
            } else if (field === 'ì¬ì„œë¹„ìŠ¤ìœ¨') {
                // íŒì—… íŠ¸ë¦¬ê±°ìš© ê°€ì§œ ì…ë ¥ì°½
                const div = document.createElement('div');
                div.className = 'fake-input';
                div.onclick = openReserviceModal;
                div.innerHTML = `<span class="placeholder">í„°ì¹˜í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”</span>`;
                div.id = 'reservice_ui_display';
                container.appendChild(div);

                // ì‹¤ì œ ê°’ ì €ì¥ìš© ìˆ¨ê²¨ì§„ ì…ë ¥ì°½
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.id = 'user_field_' + index;
                container.appendChild(hiddenInput);
            } else {
                // ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥ì°½
                const input = document.createElement('input');
                input.type = 'text';
                input.id = 'user_field_' + index;
                input.placeholder = field + ' ì…ë ¥';
                container.appendChild(input);
            }
        });
    }

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
    function saveUserInfo() {
        const userData = {};
        USER_FIELDS.forEach((field, index) => {
            const val = document.getElementById('user_field_' + index).value;
            userData['field_' + index] = val;
        });
        localStorage.setItem('myChecklistUserInfo', JSON.stringify(userData));
    }

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadUserInfo() {
        const savedData = localStorage.getItem('myChecklistUserInfo');
        if (savedData) {
            const userData = JSON.parse(savedData);
            USER_FIELDS.forEach((field, index) => {
                const input = document.getElementById('user_field_' + index);
                if (input && userData['field_' + index]) {
                    input.value = userData['field_' + index];
                    // ì¬ì„œë¹„ìŠ¤ìœ¨ UI ì—…ë°ì´íŠ¸ (ì €ì¥ëœ ê°’ì´ ìˆì„ ê²½ìš°)
                    if (USER_FIELDS[index] === 'ì¬ì„œë¹„ìŠ¤ìœ¨') {
                        updateReserviceUI(input.value);
                    }
                }
            });
        }
    }

    // --- ì¬ì„œë¹„ìŠ¤ìœ¨ íŒì—… ê´€ë ¨ í•¨ìˆ˜ ---
    function openReserviceModal() {
        document.getElementById('reserviceModal').classList.remove('hidden');
    }

    function closeReserviceModal() {
        document.getElementById('reserviceModal').classList.add('hidden');
    }

    function saveReserviceRate() {
        const before = document.getElementById('modal_reservice_before').value;
        const after = document.getElementById('modal_reservice_after').value;

        // ì €ì¥í•  ë¬¸ìì—´ í¬ë§· ìƒì„±
        const displayStr = `êµìœ¡ì „: ${before}%  /  êµìœ¡í›„: ${after}%`;
        
        // ìˆ¨ê²¨ì§„ inputì— ê°’ ì €ì¥ (ì—‘ì…€ ë° ë¡œì»¬ìŠ¤í† ë¦¬ì§€ìš©)
        // ì¬ì„œë¹„ìŠ¤ìœ¨ í•„ë“œì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ì•„ì„œ ì €ì¥
        const index = USER_FIELDS.indexOf("ì¬ì„œë¹„ìŠ¤ìœ¨");
        document.getElementById('user_field_' + index).value = displayStr;

        // í™”ë©´ UI ì—…ë°ì´íŠ¸
        updateReserviceUI(displayStr);
        
        closeReserviceModal();
    }

    function updateReserviceUI(valueStr) {
        const ui = document.getElementById('reservice_ui_display');
        if (!valueStr) return;
        
        // "êµìœ¡ì „: 10% / êµìœ¡í›„: 5%" ë¬¸ìì—´ì„ íŒŒì‹±í•´ì„œ ì¢Œìš°ë¡œ ë°°ì¹˜
        const parts = valueStr.split('/');
        if (parts.length === 2) {
            ui.innerHTML = `<span>${parts[0].trim()}</span> <span>${parts[1].trim()}</span>`;
        } else {
            ui.innerText = valueStr;
        }
    }
    // -----------------------------

    // 2. ì œí’ˆ ëª©ë¡ ë Œë”ë§
    function renderProductOptions() {
        const container = document.getElementById('productGrid');
        container.innerHTML = ''; // ì´ˆê¸°í™”

        for (const product in CHECKLIST_DATA) {
            const btn = document.createElement('div');
            btn.className = 'option-card';
            
            // ì•„ì´ì½˜ ì´ë¯¸ì§€ ì¶”ê°€
            const img = document.createElement('img');
            img.src = PRODUCT_ICONS[product];
            btn.appendChild(img);

            const span = document.createElement('span');
            span.innerText = product;
            btn.appendChild(span);

            btn.onclick = function() { selectProduct(product, btn); };
            container.appendChild(btn);
        }
    }

    // ì œí’ˆ ì„ íƒ ì‹œ ì‹¤í–‰
    function selectProduct(product, element) {
        currentProduct = product;
        currentSymptom = ""; // ì œí’ˆì´ ë°”ë€Œë©´ ì¦ìƒ ì´ˆê¸°í™”

        // ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ì´ë™ (ì œí’ˆ ì„ íƒ ìˆ¨ê¹€ -> ì¦ìƒ ì„ íƒ í‘œì‹œ)
        document.getElementById('productSelectionCard').classList.add('hidden');
        document.getElementById('symptomSelectionCard').classList.remove('hidden');

        loadSymptoms(product);
    }

    // [ì´ì „] ì¦ìƒ ì„ íƒ -> ì œí’ˆ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
    function goBackToProduct() {
        document.getElementById('symptomSelectionCard').classList.add('hidden');
        document.getElementById('productSelectionCard').classList.remove('hidden');
    }

    // 3. ì¦ìƒ ëª©ë¡ ë¡œë“œ
    function loadSymptoms(product) {
        const container = document.getElementById('symptomGrid');
        
        // ì´ˆê¸°í™”
        container.innerHTML = '';

        const symptoms = CHECKLIST_DATA[product];
        for (const symptom in symptoms) {
            const btn = document.createElement('div');
            btn.className = 'option-card';
            
            const img = document.createElement('img');
            img.src = getSymptomIcon(symptom);
            btn.appendChild(img);

            const span = document.createElement('span');
            span.innerText = symptom;
            btn.appendChild(span);

            btn.onclick = function() { selectSymptom(symptom, btn); };
            container.appendChild(btn);
        }
    }

    // ì¦ìƒ ì„ íƒ ì‹œ ì‹¤í–‰
    function selectSymptom(symptom, element) {
        currentSymptom = symptom;
        
        // ì¦ìƒ ì„ íƒ ì‹œ ìƒˆë¡œìš´ ID ìƒì„± (ì´ì „ ë²„íŠ¼ìœ¼ë¡œ ëŒì•„ì˜¨ ê²½ìš°ê°€ ì•„ë‹ ë•Œ)
        // í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœíˆ ì„ íƒë§Œ í•˜ê³  'ë‹¤ìŒ'ì„ ëˆŒëŸ¬ì•¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ê°€ë¯€ë¡œ
        // ì‹¤ì œ ID ìƒì„±ì€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì§„ì… ì‹œ í˜¹ì€ ì €ì¥ ì‹œì ì— ê´€ë¦¬í•  ìˆ˜ë„ ìˆì§€ë§Œ,
        // "ì´ì „ ë²„íŠ¼ ëˆŒë €ì„ ë•Œë§Œ ìœ ì§€" ì¡°ê±´ì— ë”°ë¼, ìƒˆë¡œ ì§„ì…í•˜ë©´ IDë¥¼ ìƒˆë¡œ ë”°ëŠ”ê²Œ ë§ìŒ.
        // ë‹¤ë§Œ, ë’¤ë¡œê°€ê¸°ë¡œ ì™”ì„ ë•ŒëŠ” elementì— .selectedê°€ ì´ë¯¸ ìˆì„ ìˆ˜ ìˆìŒ.
        // ì—¬ê¸°ì„œëŠ” UI ì²˜ë¦¬ë§Œ í•˜ê³ , ë°ì´í„° ë¡œì§ì€ goToChecklist ë“±ì—ì„œ ì²˜ë¦¬.
        
        // ë§Œì•½ ì´ì „ì— ìƒì„±ëœ IDê°€ ì—†ë‹¤ë©´ ìƒˆë¡œ ìƒì„± (ìƒˆë¡œìš´ ì ê²€ ì‹œì‘)
        if (!currentEntryId) {
            currentEntryId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
        }

        // ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ (ì„ íƒëœ ê²ƒë§Œ ê°•ì¡°)
        const buttons = document.querySelectorAll('#symptomGrid .option-card');
        buttons.forEach(b => b.classList.remove('selected'));
        element.classList.add('selected');
    }

    // [ì´ì „] ì²´í¬ë¦¬ìŠ¤íŠ¸ -> ì¦ìƒ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
    function goBackToSymptom() {
        document.getElementById('checklistSection').classList.add('hidden');
        document.getElementById('symptomSelectionCard').classList.remove('hidden');
    }

    // [ë‹¤ìŒ] ì¦ìƒ ì„ íƒ ì™„ë£Œ -> ì²´í¬ë¦¬ìŠ¤íŠ¸ í™”ë©´ìœ¼ë¡œ ì´ë™
    function goToChecklist() {
        if (!currentSymptom) {
            alert("ì¦ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        document.getElementById('symptomSelectionCard').classList.add('hidden');
        document.getElementById('checklistSection').classList.remove('hidden');

        loadChecklist();
    }

    // 4. ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
    function loadChecklist() {
        const checklistSection = document.getElementById('checklistSection');
        const checklistItems = document.getElementById('checklistItems');
        const checklistTitle = document.getElementById('checklistTitle');

        if (!currentProduct || !currentSymptom) return;

        // ì œëª© ì„¤ì •
        checklistTitle.innerText = `âœ… [${currentProduct}] ${currentSymptom} ì ê²€`;
        
        // ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
        checklistItems.innerHTML = '';
        
        // í•­ëª© ìƒì„±
        const steps = CHECKLIST_DATA[currentProduct][currentSymptom];
        steps.forEach((step, index) => {
            const div = document.createElement('div');
            div.className = 'checklist-item';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = 'check_step_' + index;
            checkbox.value = step;

            // ì €ì¥ëœ ìƒíƒœ ë³µì›
            const stateKey = `${currentProduct}_${currentSymptom}`;
            if (checklistState[stateKey] && checklistState[stateKey].has(index)) {
                checkbox.checked = true;
                div.classList.add('checked');
            }

            // ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ìŠ¤íƒ€ì¼ ë³€ê²½ ì´ë²¤íŠ¸
            div.onclick = function(e) {
                // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€ (ì²´í¬ë°•ìŠ¤ ì§ì ‘ í´ë¦­ ì‹œ ì¤‘ë³µ ë°©ì§€)
                // label ë‚´ë¶€ ìš”ì†Œ(span ë“±)ë¥¼ í´ë¦­í–ˆì„ ë•Œë„ labelì´ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ë¯€ë¡œ ì œì™¸í•´ì•¼ í•¨
                if (e.target.tagName !== 'INPUT' && !e.target.closest('label')) {
                    checkbox.click();
                }
            };
            checkbox.onchange = function() {
                // ìƒíƒœ ì—…ë°ì´íŠ¸
                if (!checklistState[stateKey]) {
                    checklistState[stateKey] = new Set();
                }

                if(this.checked) {
                    div.classList.add('checked');
                    checklistState[stateKey].add(index);
                }
                else {
                    div.classList.remove('checked');
                    checklistState[stateKey].delete(index);
                }
                updateProgressBar(); // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            };

            const label = document.createElement('label');
            label.htmlFor = 'check_step_' + index; // ë¼ë²¨ì„ ì²´í¬ë°•ìŠ¤ì™€ ì—°ê²°
            
            // ë‹¨ê³„ ë²ˆí˜¸ (ë±ƒì§€)
            const badge = document.createElement('span');
            badge.className = 'step-badge';
            badge.innerText = String(index + 1).padStart(2, '0'); // 01, 02 í˜•íƒœ
            
            // ë‚´ìš©
            const content = document.createElement('span');
            content.innerHTML = step;

            label.appendChild(badge);
            label.appendChild(content);
            div.appendChild(checkbox);
            div.appendChild(label);
            checklistItems.appendChild(div);
        });

        checklistSection.classList.remove('hidden');
        updateProgressBar(); // ì´ˆê¸° ë¡œë“œ ì‹œ ì§„í–‰ë¥  í‘œì‹œ
    }

    // [ê¸°ëŠ¥] ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
    function updateProgressBar() {
        const checkboxes = document.querySelectorAll('#checklistItems input[type="checkbox"]');
        const total = checkboxes.length;
        const checked = document.querySelectorAll('#checklistItems input[type="checkbox"]:checked').length;
        
        const percent = total === 0 ? 0 : Math.round((checked / total) * 100);
        
        document.getElementById('checklistProgressBar').style.width = percent + "%";
        document.getElementById('progressText').innerText = `${percent}% ì™„ë£Œ (${checked}/${total})`;
    }

    // [ë‹¤ìŒ] ì²´í¬ë¦¬ìŠ¤íŠ¸ -> ì¢…í•© ì˜ê²¬ ì‘ì„±ìœ¼ë¡œ ì´ë™
    function goToOpinion() {
        document.getElementById('checklistSection').classList.add('hidden');
        document.getElementById('opinionSection').classList.remove('hidden');
    }

    // [ì´ì „] ì¢…í•© ì˜ê²¬ -> ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ëŒì•„ê°€ê¸°
    function goBackToChecklist() {
        document.getElementById('opinionSection').classList.add('hidden');
        document.getElementById('checklistSection').classList.remove('hidden');
    }

    // 5. ì €ì¥ ì²˜ë¦¬ (ì„ì‹œ ì €ì¥ í›„ íŒì—…)
    function processSave() {
        // í˜„ì¬ ì‹œê°„ (ì €ì¥ ì¼ì‹œ)
        const now = new Date();
        const timeStr = now.getFullYear() + "-" + 
                        String(now.getMonth() + 1).padStart(2, '0') + "-" + 
                        String(now.getDate()).padStart(2, '0') + " " + 
                        String(now.getHours()).padStart(2, '0') + ":" + 
                        String(now.getMinutes()).padStart(2, '0');

        // ì—‘ì…€ ì €ì¥ìš© í–‰ ë°ì´í„° ê°ì²´ ìƒì„± (ê°€ë¡œ 1ì¤„)
        // ìˆœì„œë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•´ í‚¤ ì…ë ¥ ìˆœì„œì— ì£¼ì˜í•˜ê±°ë‚˜, ë‚˜ì¤‘ì— header ì˜µì…˜ ì‚¬ìš©
        const rowData = {
            // ê³ ìœ  ID ì €ì¥ (ì—‘ì…€ ì¶œë ¥ ì œì™¸ìš©, ë‚´ë¶€ ê´€ë¦¬ìš©)
            "_id": currentEntryId || (Date.now().toString() + Math.random().toString(36).substr(2, 9)),
            "ì €ì¥ì¼ì‹œ": timeStr
        };

        // (1) ì‚¬ìš©ì ì •ë³´ ë§¤í•‘
        USER_FIELDS.forEach((field, index) => {
            const val = document.getElementById('user_field_' + index).value || "";
            
            if (field === "ì¬ì„œë¹„ìŠ¤ìœ¨") {
                // "êµìœ¡ì „: 10%  /  êµìœ¡í›„: 5%" í˜•ì‹ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œí•˜ì—¬ ë¶„ë¦¬
                let before = "";
                let after = "";
                if (val.includes("/")) {
                    const parts = val.split("/");
                    before = parts[0].replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ì¶”ì¶œ
                    after = parts[1].replace(/[^0-9]/g, "");
                }
                rowData["ì¬ì„œë¹„ìŠ¤ìœ¨[êµìœ¡ì „]"] = before;
                rowData["ì¬ì„œë¹„ìŠ¤ìœ¨[êµìœ¡í›„]"] = after;
            } else {
                rowData[field] = val;
            }
        });

        // (2) ì œí’ˆ ë° ì¦ìƒ
        rowData["ì œí’ˆ"] = currentProduct;
        rowData["ì¦ìƒ"] = currentSymptom;

        // (3) ì ê²€í•­ëª© (ì²´í¬ëœ ë²ˆí˜¸ë§Œ ì‰¼í‘œë¡œ êµ¬ë¶„í•´ì„œ ì €ì¥)
        const checkboxes = document.querySelectorAll('#checklistItems input[type="checkbox"]');
        let checklistResults = [];
        checkboxes.forEach((box, index) => {
            if (box.checked) {
                checklistResults.push(index + 1);
            }
        });
        rowData["ì ê²€í•­ëª©"] = checklistResults.join(", ");

        // (4) ì¢…í•© ì˜ê²¬
        rowData["ì¢…í•©ì˜ê²¬"] = document.getElementById('opinionInput').value;

        // --- ëˆ„ì  ì €ì¥ ë¡œì§ ---
        // ê¸°ì¡´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        let historyData = JSON.parse(localStorage.getItem('checklistHistoryData') || "[]");

        // [ì¤‘ë³µ ë°©ì§€] ê³ ìœ  ID(_id)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì • ì—¬ë¶€ íŒë‹¨
        const existingIndex = historyData.findIndex(item => item["_id"] === rowData["_id"]);

        if (existingIndex !== -1) {
            // ì´ë¯¸ ì¡´ì¬í•˜ë©´ -> ë®ì–´ì“°ê¸° (Update)
            historyData[existingIndex] = rowData;
        } else {
            // ì—†ìœ¼ë©´ -> ìƒˆë¡œ ì¶”ê°€ (Insert)
            historyData.push(rowData);
        }
        
        // ë‹¤ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ë‹¤ìŒ ë²ˆ ì¶”ê°€ë¥¼ ìœ„í•´)
        localStorage.setItem('checklistHistoryData', JSON.stringify(historyData));

        // ì €ì¥ í›„ ìƒíƒœ ì´ˆê¸°í™” (ì´ì „ ì²´í¬ì‚¬í•­ ì‚­ì œ)
        delete checklistState[`${currentProduct}_${currentSymptom}`];
        // ì¢…í•©ì˜ê²¬ì€ ì œí’ˆë³„ ê³µìœ ì´ë¯€ë¡œ ìœ ì§€í• ì§€ ì‚­ì œí• ì§€ ê²°ì •í•´ì•¼ í•˜ë‚˜, 
        // "ì €ì¥ë²„íŠ¼ ëˆ„ë¥´ë©´ ì´ì „ ì²´í¬ì‚¬í•­ ì—†ì–´ì§€ê²Œí•´" ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ í•´ë‹¹ ì„¸ì…˜ ì¢…ë£Œë¡œ íŒë‹¨.
        // í•˜ì§€ë§Œ ì¢…í•©ì˜ê²¬ì€ ì œí’ˆ ë‹¨ìœ„ ê³µìœ ë¼ ë‹¤ë¥¸ ì¦ìƒ ì ê²€ ì‹œ í•„ìš”í•  ìˆ˜ ìˆìŒ.
        // ì‚¬ìš©ì ìš”êµ¬: "ì¢…í•©ì˜ê²¬ ì‘ì„±í›„ ì €ì¥ë²„íŠ¼ ëˆ„ë¥´ë©´ ì´ì „ ì²´í¬ì‚¬í•­ ì—†ì–´ì§€ê²Œí•´" -> ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”.
        
        // ì´ë ¥ í™”ë©´ìœ¼ë¡œ ì´ë™
        showHistoryScreen();
    }

    // [í™”ë©´] ì´ë ¥ í™”ë©´ í‘œì‹œ
    function showHistoryScreen() {
        document.getElementById('opinionSection').classList.add('hidden');
        document.getElementById('historyScreen').classList.remove('hidden');
        renderHistoryList();
    }

    // [ê¸°ëŠ¥] ì´ë ¥ ëª©ë¡ ë Œë”ë§
    function renderHistoryList() {
        const historyData = JSON.parse(localStorage.getItem('checklistHistoryData') || "[]");
        const container = document.getElementById('historyListContainer');
        const countSpan = document.getElementById('historyCount');
        
        container.innerHTML = '';
        countSpan.innerText = historyData.length;

        // ìµœì‹ ìˆœìœ¼ë¡œ í‘œì‹œ
        [...historyData].reverse().forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'history-item';
            // í‘œì‹œ ë‚´ìš©: [ì œí’ˆ] ì¦ìƒ (ì ê²€í•­ëª©: 1, 2...)
            div.innerHTML = `<strong>[${item['ì œí’ˆ']}]</strong> ${item['ì¦ìƒ']} <span style="color:#666; font-size:0.8rem;">| ì ê²€: ${item['ì ê²€í•­ëª©'] || '-'} | ${item['ì €ì¥ì¼ì‹œ']}</span>`;
            container.appendChild(div);
        });
    }

    // [ë²„íŠ¼] ì´ë ¥ í™”ë©´ -> ì œí’ˆ ì„ íƒ (ìƒˆë¡œìš´ ì ê²€ ì‹œì‘)
    function goToProductSelectFromHistory() {
        // ì•± ë¦¬ì…‹ (ì…ë ¥ê°’ ì´ˆê¸°í™”)
        resetApp(); 
        
        document.getElementById('historyScreen').classList.add('hidden');
        document.getElementById('productSelectionCard').classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    // [ë²„íŠ¼] ì—‘ì…€ ë‚´ë³´ë‚´ê¸°
    function exportHistoryToExcel() {
        if (!confirm("í˜„ì¬ê¹Œì§€ ì €ì¥ëœ ì´ë ¥ì„ ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        // í˜„ì¬ ì‹œê°„ ìƒì„± (íŒŒì¼ëª…ìš©)
        const now = new Date();
        const timeStr = now.getFullYear() + "-" + 
                        String(now.getMonth() + 1).padStart(2, '0') + "-" + 
                        String(now.getDate()).padStart(2, '0') + " " + 
                        String(now.getHours()).padStart(2, '0') + ":" + 
                        String(now.getMinutes()).padStart(2, '0');

        const historyData = JSON.parse(localStorage.getItem('checklistHistoryData') || "[]");

        // ì—‘ì…€ í—¤ë” ìˆœì„œ ì§€ì •
        const headerOrder = [
            "ì €ì¥ì¼ì‹œ", "ë‹´ë‹¹/ì‹¤", "ì„¼í„°", "ì‚¬ë²ˆ", "ì„±ëª…", "êµìœ¡ ì´ìˆ˜ì¼ì", 
            "ì¬ì„œë¹„ìŠ¤ìœ¨[êµìœ¡ì „]", "ì¬ì„œë¹„ìŠ¤ìœ¨[êµìœ¡í›„]", "ì½”ì¹­ì", 
            "ì œí’ˆ", "ì¦ìƒ", "ì ê²€í•­ëª©", "ì¢…í•©ì˜ê²¬"
        ];

        // ì—‘ì…€ ì›Œí¬ì‹œíŠ¸ ìƒì„± (í—¤ë” ìˆœì„œ ì ìš©)
        const ws = XLSX.utils.json_to_sheet(historyData, { header: headerOrder });
        
        // ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì •
        ws['!cols'] = [
            { wch: 20 }, // ì €ì¥ì¼ì‹œ
            { wch: 10 }, // ë‹´ë‹¹/ì‹¤
            { wch: 10 }, // ì„¼í„°
            { wch: 10 }, // ì‚¬ë²ˆ
            { wch: 10 }, // ì„±ëª…
            { wch: 15 }, // êµìœ¡ ì´ìˆ˜ì¼ì
            { wch: 10 }, // ì¬ì„œë¹„ìŠ¤ìœ¨[êµìœ¡ì „]
            { wch: 10 }, // ì¬ì„œë¹„ìŠ¤ìœ¨[êµìœ¡í›„]
            { wch: 10 }, // ì½”ì¹­ì
            { wch: 10 }, // ì œí’ˆ
            { wch: 20 }, // ì¦ìƒ
            { wch: 50 }, // ì ê²€í•­ëª© (ë‚´ìš©ì´ ê¸¸ì–´ì„œ ë„“ê²Œ)
            { wch: 30 }  // ì¢…í•©ì˜ê²¬
        ];

        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "ì ê²€ê²°ê³¼");

        // íŒŒì¼ëª… ìƒì„±
        const fileName = `ì ê²€ê²°ê³¼_ëˆ„ì _${timeStr.replace(/[-: ]/g, '')}.xlsx`;

        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        XLSX.writeFile(wb, fileName);

    }

    // ì•± ì´ˆê¸°í™” í•¨ìˆ˜
    function resetApp() {
        // ì…ë ¥ê°’ ì´ˆê¸°í™”
        document.getElementById('opinionInput').value = "";
        currentProduct = "";
        currentSymptom = "";
        currentEntryId = null; // ID ì´ˆê¸°í™” (ìƒˆë¡œìš´ ì ê²€)
        
        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ ì´ˆê¸°í™” (ìƒˆë¡œìš´ ì„¸ì…˜ ì‹œì‘)
        for (const key in checklistState) delete checklistState[key];
        
        // í™”ë©´ ì´ë™ (ë©”ì¸ í™”ë©´ìœ¼ë¡œ)
        document.getElementById('opinionSection').classList.add('hidden');
        document.getElementById('checklistSection').classList.add('hidden');
        document.getElementById('symptomSelectionCard').classList.add('hidden');
        document.getElementById('productSelectionCard').classList.remove('hidden');
        
        // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
        window.scrollTo(0, 0);
    }

    // [ê¸°ëŠ¥] ëˆ„ì  ë°ì´í„° ì‚­ì œ (ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸)
    function clearHistoryData() {
        if(confirm("ì •ë§ë¡œ ëˆ„ì ëœ ëª¨ë“  ì ê²€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤)")) {
            const password = prompt("ë°ì´í„°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n(ê¸°ë³¸ê°’: 1234)");
            if (password === "1234") {
                localStorage.removeItem('checklistHistoryData');
                alert("ëˆ„ì  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì ê²€ì„ ì‹œì‘í•˜ì„¸ìš”.");
                renderHistoryList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } else if (password !== null) {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
        }
    }
</script>

</body>
</html>
